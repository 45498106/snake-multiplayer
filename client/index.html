<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Snake multiplayer</title>
  </head>

  <body>
    <canvas id="board" width="600px" height="600px" style="position: absolute; top: 10px; left: 10px;"></canvas>
    <span style="position:absolute;top:550px;" id="txt_status"></span>
  </body>

  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script>

    var board;
    var socket;
    var player_colors = ['#2196F3', '#FF5722', '#607D8B', '#E91E63',
                         '#9C27B0', '#795548', '#009688', '#4CAF50'];

    var canvas_board = document.getElementById('board');
    var ctx_board = canvas_board.getContext('2d')

    init();

    function init() {
      // Init socker.io
      initSocket();

      // Keystroke handler
      document.onkeydown = function(e) {
          e = e || window.event;
          // TODO: Limit rate
          if (e.keyCode >= 37 && e.keyCode <= 40)
            socket.emit('keystroke', e.keyCode - 37);
      };

    }

    function initSocket() {
      socket = io('http://127.0.0.1:3000');

      socket.on('connect', function() {
        socket.emit('start', 0);
      });

      socket.on('status', function(data) {
        board = data;
        renderBoard();
      });

      socket.on('disconnect', function() {
        document.getElementById('txt_status').innerHTML = 'disconnected';
      });
    }

    function renderBoard() {
      for(var r = 0; r < 50; r++) {
        for(var c = 0; c < 50; c++) {
          var playerId = board[r][c];

          var fillColor = '#DDD';
          if (playerId > 0) {
            fillColor = player_colors[playerId % player_colors.length];
          } else if (playerId < 0) {
            fillColor = '#424242';
          }

          ctx_board.fillStyle = fillColor;
          ctx_board.fillRect(c * 10, r * 10, 9, 9);
        }
      }
    }

  </script>


</html>

